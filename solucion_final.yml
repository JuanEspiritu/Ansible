---
# =============================================================================
# SOLUCIÃ“N FINAL - Control via vSphere REST API
# =============================================================================

- hosts: localhost
  connection: local  
  gather_facts: no
  vars:
    ansible_become: false
    vcenter_host: "168.121.48.254"
    vcenter_port: 10123
    vcenter_user: "root"
    vcenter_pass: "qwe123$"
    
  tasks:
    - name: "ğŸ”‘ Obtener token de autenticaciÃ³n vSphere"
      uri:
        url: "https://{{ vcenter_host }}:{{ vcenter_port }}/rest/com/vmware/cis/session"
        method: POST
        validate_certs: no
        force_basic_auth: yes
        url_username: "{{ vcenter_user }}"
        url_password: "{{ vcenter_pass }}"
        headers:
          Content-Type: "application/json"
      register: auth_result
      
    - name: "âœ… Token obtenido"
      debug:
        msg: "AutenticaciÃ³n exitosa con vSphere API"
      when: auth_result.status == 200
      
    - name: "ğŸ“‹ Estrategia recomendada"
      debug:
        msg: |
          ğŸ¯ Ahora que confirmamos acceso a vSphere API, tenemos 2 opciones:
          
          âœ… OPCIÃ“N A: Configurar red manualmente UNA VEZ
          - Cambiar Ubuntu Server a tu red (192.168.0.48)
          - DespuÃ©s Ansible maneja TODO automÃ¡ticamente
          
          âœ… OPCIÃ“N B: Usar vSphere API para ejecutar comandos  
          - Control completo via API de vCenter
          - MÃ¡s complejo pero 100% automatizado
          
          ğŸ“ RECOMENDACIÃ“N: OpciÃ³n A (mÃ¡s simple y educativo)
          
          ğŸ“ PRÃ“XIMO PASO:
          1. Configurar red de Ubuntu Server una sola vez
          2. Ejecutar: ansible-playbook site.yml --ask-pass
          3. Â¡Ansible hace todo el resto!